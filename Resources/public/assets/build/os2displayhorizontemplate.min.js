/**
 * @name ItkHorizonTemplateBundle
 * @version v1.0.0
 * @link https://github.com/itk-os2display/horizon-template-bundle
 */
angular.module("toolsModule").directive("horizonEditor",["mediaFactory","$timeout",function(e,i){return{restrict:"E",replace:!0,scope:{slide:"=",close:"&"},link:function(i){var d=null;i.step=null,i.selectedMedia=[],i.backgroundPicker=function(e){d=e,console.log(i.slide.media),i.step="background-picker"},i.pickFromMedia=function(){var e=i.slide.options.regions[d];""!==e.mediaIndex&&null!==e.mediaIndex&&void 0!==e.mediaIndex&&(i.selectedMedia=[i.slide.media[e.mediaIndex]]),i.step="pick-from-media"},i.pickFromComputer=function(){i.step="pick-from-computer"},i.back=function(){i.selectedMedia=[],i.step=null,d=null};var n=function(){for(var e=i.slide.options.regions.reduce(function(e,i){return""!==i.mediaIndex&&null!==i.mediaIndex&&void 0!==i.mediaIndex&&e.indexOf(i.mediaIndex)===-1&&e.push(i.mediaIndex),e},[]),d=[],n=0;n<i.slide.media.length;n++)if(e.indexOf(n)===-1)for(var o in i.slide.options.regions)o=i.slide.options.regions[o],o.mediaIndex>n&&(o.mediaIndex=o.mediaIndex-1);else d.push(i.slide.media[n]);i.slide.media=d},o=function(e){var o=[],s=!1,l=null;for(var a in i.slide.media){var t=i.slide.media[a];t.id===e.id&&(s=!0,l=a),o.push(t)}s||(o.push(e),l=o.length-1),i.step=null,i.slide.media=o,i.slide.options.regions[d].mediaIndex=l,n()};i.$on("mediaOverview.selectMedia",function(e,i){o(i)}),i.$on("mediaUpload.uploadSuccess",function(n,o){e.getMedia(o.id).then(function(e){i.slide.media.push(e),i.slide.options.regions[d].mediaIndex=i.slide.media.length-1},function(e){busService.$emit("log.error",{cause:e,msg:"Kunne ikke tilf√∏je media."})});var s=o.queue.find(function(e,i){return!e.isSuccess});s||i.close()})},templateUrl:"/bundles/itkhorizontemplate/apps/toolsModule/horizon-editor.html"}}]);
